<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RaviSomaTools – Gene ID Resolver</title>

<style>
body {
    background: #ff4db8;
    font-family: Arial, sans-serif;
    padding: 20px;
    color: #000;
}
.container {
    width: 450px;
    padding: 20px;
    background: #ff79cd;
    border-radius: 10px;
    box-shadow: 0 0 10px #0003;
}
input, select, button {
    width: 95%;
    padding: 10px;
    margin: 6px 0;
    border-radius: 6px;
    border: 1px solid #444;
    font-size: 16px;
}
button {
    background: #000;
    color: #fff;
    cursor: pointer;
}
button:hover {
    opacity: 0.8;
}
label { font-weight: bold; }
.result-box {
    background: #ffe6f5;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
    font-size: 14px;
}
</style>

<script>
// ========== UniProt lookup ==========
async function fetchUniProt(gene, species) {
    const url = `https://rest.uniprot.org/uniprotkb/search?query=gene_exact:${gene}+AND+organism_name:${species}&format=json`;
    try {
        const res = await fetch(url);
        if (!res.ok) return "";
        const json = await res.json();
        if (json.results && json.results.length > 0)
            return json.results[0].primaryAccession;
    } catch(e) {
        console.log("UniProt error", e);
    }
    return "";
}

// ========== NCBI Entrez lookup ==========
async function fetchEntrez(gene, species) {
    const query = encodeURIComponent(gene + " " + species);
    const url = `https://api.ncbi.nlm.nih.gov/datasets/v2/gene/suggest?query=${query}`;
    try {
        const res = await fetch(url);
        if (!res.ok) return "";
        const json = await res.json();
        if (json.suggestions && json.suggestions.length > 0 && json.suggestions[0].gene_id)
            return json.suggestions[0].gene_id;
    } catch(e) {
        console.log("Entrez error", e);
    }
    return "";
}

// ========== Ensembl lookup ==========
async function fetchEnsembl(gene, species="rattus_norvegicus") {
    const url = `https://rest.ensembl.org/xrefs/symbol/${species}/${gene}?content-type=application/json`;
    try {
        const res = await fetch(url);
        if (!res.ok) return "";
        const json = await res.json();
        if (json && json.length > 0 && json[0].id)
            return json[0].id;
    } catch(e) {
        console.log("Ensembl error", e);
    }
    return "";
}

// ========== GO FUNCTION ==========
async function goLookup() {

    const gene = document.getElementById("gene").value.trim();
    const speciesHuman = document.getElementById("species").value;

    const speciesMap = {
        "Rattus norvegicus": "rattus_norvegicus",
        "Homo sapiens": "homo_sapiens",
        "Mus musculus": "mus_musculus"
    };
    const ensemblSpecies = speciesMap[speciesHuman] || "rattus_norvegicus";

    if (!gene) {
        alert("Enter a Gene Symbol first.");
        return;
    }

    document.getElementById("result").innerHTML = "Fetching data...";

    const uni = await fetchUniProt(gene, speciesHuman);
    const ensg = await fetchEnsembl(gene, ensemblSpecies);
    const entrez = await fetchEntrez(gene, speciesHuman);

    document.getElementById("uniprot").value = uni;
    document.getElementById("ensembl").value = ensg;
    document.getElementById("entrez").value = entrez;

    document.getElementById("result").innerHTML = `
        <b>Lookup Complete</b><br>
        Gene: ${gene}<br>
        UniProt: ${uni || "Not found"}<br>
        Ensembl: ${ensg || "Not found"}<br>
        Entrez: ${entrez || "Not found"}<br>
    `;
}
</script>
</head>

<body>

<div class="container">
    <h2><b>RaviSomaTools – Gene ID Resolver</b></h2>

    <label>Gene Symbol</label>
    <input id="gene" placeholder="e.g., Cyp2d3">

    <label>Species</label>
    <select id="species">
        <option>Rattus norvegicus</option>
        <option>Homo sapiens</option>
        <option>Mus musculus</option>
    </select>

    <label>UniProt ID</label>
    <input id="uniprot" placeholder="Will auto-fill">

    <label>Ensembl Gene ID</label>
    <input id="ensembl" placeholder="Will auto-fill">

    <label>NCBI Entrez Gene ID</label>
    <input id="entrez" placeholder="Will auto-fill">

    <button onclick="goLookup()">GO</button>

    <div id="result" class="result-box"></div>
</div>

</body>
</html>
